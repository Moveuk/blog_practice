# 2021-12-22 log

## JPA - db연동을 위한 jpa 속성 설정

```yml
 jpa:
    open-in-view: true
    hibernate:
      ddl-auto: create # table이 있을 경우 제거하고 다시 만들어서 사용
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl # entity(테이블)를 만들 때 변수명 그대로 테이블을 만드는 전략
      use-new-id-generator-mappings: false  # jpa 기본전략 따라가지 않음
    show-sql: true # sql문 console에 보여줌
    properties:
      hibernate.format_sql: true # sql문을 가독성 좋게 console에 띄워줌
```

```java
@Entity
@Data
@AllArgsConstructor
public class User {
	
	@Id // pk 설정
	@GeneratedValue(strategy = GenerationType.IDENTITY) // 프로젝트에 연결된 DB 넘버링 전략을 따라감.
	// Sequence(시퀀스 사용-오라클), Table(테이블의 번호를 맞춰서 사용), auto(자동) 등의 옵션이 있다.
	// IDENTITY -> 시퀀스 경우 오라클은 시퀀스, mysql은 auto_increment를 사용
	private int id; // 시퀀스, auto_increment
	
	@Column(nullable = false, length = 30)
	private String username; // 아이디
	
	@Column(nullable = false, length = 100) // 123456 => 해쉬 (비밀번호 암호화를 위한 length 크기 설정)
	private String password;
	
	@Column(nullable = false, length = 50)
	private String email;
	
	@ColumnDefault("'user'") // user 디폴트 값으로 주며 String임을 알려주기 위하여 '' 사용
	private String role; // Enum을 쓰는게 좋음. (Enum을 쓰면 도메인(사용가능한 범위)을 만들어 줄수 있음. ex) admin, user, manager
	
	@CreationTimestamp // 시간이 자동 입력
	private Timestamp createDate;
}
```

### JPA는 ORM 이다.

ORM : Object–relational mapping

ORM 이란 Java처럼 다른 언어로 된 Object를 테이블로 매핑해주는 기술을 일컫는다.


### id 값 넘버링 전략 설정

#### physical-strategy
 
PhysicalNamingStrategyStandardImpl vs SpringPhysicalNamingStrategy

1. org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl

 entity(테이블)를 만들 때 변수명 그대로 테이블을 만드는 전략

2. org.springframework.boot.orm.jpa.hibernate.SpringPhysicalNamingStrategy

 entity(테이블)을 만들 때 변수명의 단어를 쪼개 언더바(`_`)로 구분해 주는 전략 예) createDate -> create_date

#### use-new-id-generator-mappings

```java
 jpa:
    hibernate:
      naming:
        physical-strategy: org.hibernate.boot.model.naming.PhysicalNamingStrategyStandardImpl
      use-new-id-generator-mappings: false
```

use-new-id-generator-mappings -> true 면 jpa의 매핑 룰을 따라감. false면 무시하고 entity에서 결정한 strategy 방식을 따라서 결정함.

현재는 GenerationType.IDENTITY 상태이므로 db의 넘버링 전략을 따라가게끔 설정 되어있음.


### hibernate - ddl-auto 설정

```java
 jpa:
    hibernate:
      ddl-auto: create
```

 위의 코드에서 ddl-auto 설정이 있다.

 ddl-auto가 가질 수 있는 속성으로는 create, update, none, validate 등이 있다.

 - create : 테이블을 실행할 때마다 매번 새로 만들겠다.(최초만 테이블 만든 후 update로 바꿔야함)
 - update : 테이블이 존재한다면 그 테이블 사용하여 update함.
 - none : 테이블을 직접 생성하고 수동으로 엔티티를 만들어줄 때 사용.

실행해보면 create의 경우 테이블을 drop하고 만들어서 사용하는 것을 볼 수 있음.

![image](https://user-images.githubusercontent.com/84966961/147021812-64a30d18-f64d-4e7f-871f-7a8c359197d8.png)

### jpa - show-sql 속성

위의 사진에서 sql 구문을 보여주는 기능.

#### "''" 따옴표 조심

작은 따옴표가 자동으로 안닫혀서 한시간이 소모됨.. ㅜㅜ


### jpa - hibernate.format_sql: true 속성

콘솔에서 sql을 포멧에 따라 정리해서 보여줌   

![image](https://user-images.githubusercontent.com/84966961/147025419-fbf82b0a-c73c-4643-afae-8a8d9da918c5.png)


### 테이블 생성 완료

![image](https://user-images.githubusercontent.com/84966961/147026934-f4452e34-797f-472f-8d11-9c742871993c.png)

----------


